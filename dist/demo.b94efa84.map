{"version":3,"sources":["src/utils/dep.js","src/utils/observer.js","src/utils/watcher.js","demo/index.js"],"names":["Dep","subs","Set","sub","add","target","addDep","forEach","update","targetStack","pushTarget","_target","push","popTarget","pop","defineReactive","obj","key","val","walk","dep","Object","defineProperty","enumerable","configurable","get","reactiveGetter","depend","set","reactiveSetter","newVal","notify","keys","i","length","Watcher","getter","cb","value","addSub","oldValue","data","firstName","lastName","watcher","window","console","log"],"mappings":"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","file":"demo.b94efa84.map","sourceRoot":"..","sourcesContent":["import { defineReactive } from \"./observer\";\n\nexport default class Dep {\n    constructor() {\n        this.subs = new Set();\n    }\n\n    addSub(sub) {\n        this.subs.add(sub);\n    }\n\n    depend(){\n        if(Dep.target){\n            Dep.target.addDep(this);\n        }\n    }\n\n    notify(){\n        this.subs.forEach(sub => sub.update());\n    }\n}\n\nDep.target = null;\nconst targetStack = [];\n\nexport function pushTarget(_target){\n    if(Dep.target) targetStack.push(Dep.target);\n    Dep.target = _target;\n}\n\nexport function popTarget(){\n    Dep.target = targetStack.pop();\n}\n\n","import Dep from \"./dep\";\n\nfunction defineReactive(obj, key, val) {\n    if ( val!==null && typeof val === 'object') {\n        walk(val);\n    }\n\n    const dep = new Dep();\n    Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: function reactiveGetter() {\n            dep.depend();\n        },\n        set: function reactiveSetter(newVal) {\n            val = newVal;\n            dep.notify();\n        }\n    })\n}\n\nexport function walk(obj) {\n    const keys = Object.keys(obj);\n    for(let i = 0; i < keys.length; i++ ) {\n        defineReactive(obj, keys[i], obj[keys[i]])\n    }\n}","import { pushTarget, popTarget } from \"./dep\";\n\nexport default class Watcher {\n    constructor(getter, cb) {\n        this.getter = getter;\n        this.cb = cb;\n        this.value = this.getter();\n        this.cb(this.value, null);\n    }\n\n    get(){\n        pushTarget(this);\n        const value = this.getter();\n        popTarget();\n\n        return value;\n    }\n\n    addDep(dep){\n        dep.addSub(this);\n    }\n\n    update(){\n        const value = this.get();\n        const oldValue = this.value;\n        this.value = value;\n\n        this.cb(value, oldValue);\n    }\n}","import { walk } from \"../src/utils/observer\";\nimport Watcher from \"../src/utils/watcher\";\n\n// import { mapGetters } from \"../src/index.js\";\n// import React from \"react\";\n// import ReactDOM from \"react-dom\";\n// import store from \"./store\";\n// import reactx from \"../src/index\";\n// const { Provider } = reactx;\n\n// class App extends React.Component {\n//     // getters = mapGetters([\"allDocuments\"])\n//     componentDidMount(){\n//         setTimeout(() => {\n//             console.log(\"test\", store.state)\n//             store.state.documents.documents = [\"hi\"]\n//         }, 1000)\n//     }\n//     render(){\n//         return (\n//             <Provider store={store}>\n//                 <div className = \"app\">\n//                     <h2>App</h2>\n//                 </div>\n//             </Provider>\n//         )\n//     }\n// }\n\n// ReactDOM.render(<App />, document.getElementById(\"main\"));\n\nconst data = {\n    firstName: \"hello\",\n    lastName: \"world\"\n\n}\n\nwalk(data);\n\nconst watcher = new Watcher(() => `Hi! My name is ${data.firstName} ${window.lastName}`, (val) => console.log(val));\n"]}